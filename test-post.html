<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²Œì‹œê¸€ ë“±ë¡ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        #log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ê²Œì‹œê¸€ ë“±ë¡ ë””ë²„ê¹… ë„êµ¬</h1>
    
    <div class="test-section">
        <h2>1. ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸</h2>
        <button class="btn-primary" onclick="checkLoginStatus()">ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸</button>
        <button class="btn-success" onclick="loginAsAdmin()">ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸</button>
        <button class="btn-danger" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
        <div id="loginStatus"></div>
    </div>

    <div class="test-section">
        <h2>2. ê²Œì‹œê¸€ ì‘ì„± í…ŒìŠ¤íŠ¸</h2>
        <input type="text" id="testTitle" placeholder="ì œëª© ì…ë ¥" value="í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€">
        <textarea id="testContent" rows="5" placeholder="ë‚´ìš© ì…ë ¥">ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ ê²Œì‹œê¸€ì…ë‹ˆë‹¤.</textarea>
        <button class="btn-primary" onclick="testPostCreation()">ê²Œì‹œê¸€ ë“±ë¡ í…ŒìŠ¤íŠ¸</button>
    </div>

    <div class="test-section">
        <h2>3. localStorage í™•ì¸</h2>
        <button class="btn-primary" onclick="checkLocalStorage()">localStorage í™•ì¸</button>
        <button class="btn-danger" onclick="clearBoardData()">ê²Œì‹œíŒ ë°ì´í„° ì´ˆê¸°í™”</button>
    </div>

    <div class="test-section">
        <h2>4. ì‹¤ì‹œê°„ ë¡œê·¸</h2>
        <button class="btn-primary" onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="log"></div>
    </div>

    <script>
        // ë¡œê·¸ í•¨ìˆ˜
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'ğŸ“';
            logDiv.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // 1. ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        function checkLoginStatus() {
            const currentUser = localStorage.getItem('currentUser');
            const authToken = localStorage.getItem('authToken');
            const statusDiv = document.getElementById('loginStatus');
            
            if (currentUser) {
                const user = JSON.parse(currentUser);
                statusDiv.innerHTML = `
                    <div class="status success">
                        <strong>âœ… ë¡œê·¸ì¸ë¨</strong><br>
                        ì´ë¦„: ${user.name}<br>
                        ID: ${user.id}<br>
                        ì—­í• : ${user.role || 'user'}<br>
                        í† í°: ${authToken ? 'ìˆìŒ' : 'ì—†ìŒ'}
                    </div>
                `;
                log(`ë¡œê·¸ì¸ ìƒíƒœ: ${user.name} (ID: ${user.id})`, 'success');
            } else {
                statusDiv.innerHTML = `
                    <div class="status error">
                        <strong>âŒ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ</strong><br>
                        ê²Œì‹œê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
                    </div>
                `;
                log('ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ', 'error');
            }
        }

        // ê´€ë¦¬ì ë¡œê·¸ì¸
        function loginAsAdmin() {
            const adminUser = {
                id: 0,
                username: 'admin',
                name: 'ê´€ë¦¬ì',
                email: 'admin@cstraining.kr',
                phone: '010-0000-0000',
                role: 'admin'
            };
            localStorage.setItem('currentUser', JSON.stringify(adminUser));
            localStorage.setItem('authToken', 'admin_token_' + Date.now());
            log('ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ ì™„ë£Œ', 'success');
            checkLoginStatus();
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('authToken');
            log('ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ', 'success');
            checkLoginStatus();
        }

        // 2. ê²Œì‹œê¸€ ì‘ì„± í…ŒìŠ¤íŠ¸
        function testPostCreation() {
            const user = localStorage.getItem('currentUser');
            if (!user) {
                log('âŒ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!', 'error');
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤!');
                return;
            }

            const currentUser = JSON.parse(user);
            const title = document.getElementById('testTitle').value.trim();
            const content = document.getElementById('testContent').value.trim();

            if (!title || !content) {
                log('âŒ ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            log('ê²Œì‹œê¸€ ì‘ì„± ì‹œì‘...');
            log(`ì œëª©: ${title}`);
            log(`ë‚´ìš©: ${content.substring(0, 50)}...`);

            // localStorageì—ì„œ ê²Œì‹œê¸€ ê°€ì ¸ì˜¤ê¸°
            const boardType = 'free'; // ì¹œëª© ê²Œì‹œíŒ
            const storageKey = `board_${boardType}_posts`;
            const posts = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            log(`í˜„ì¬ ê²Œì‹œê¸€ ìˆ˜: ${posts.length}`);

            // ìƒˆ ê²Œì‹œê¸€ ìƒì„±
            const newId = posts.length > 0 ? Math.max(...posts.map(p => p.id)) + 1 : 1;
            const newPost = {
                id: newId,
                title: title,
                author: currentUser.name,
                authorId: currentUser.id,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                views: 0,
                content: content,
                files: []
            };

            log(`ìƒˆ ê²Œì‹œê¸€ ID: ${newId}`);

            // ê²Œì‹œê¸€ ì¶”ê°€
            posts.push(newPost);
            localStorage.setItem(storageKey, JSON.stringify(posts));

            log(`âœ… ê²Œì‹œê¸€ ì €ì¥ ì™„ë£Œ!`, 'success');
            log(`ì „ì²´ ê²Œì‹œê¸€ ìˆ˜: ${posts.length}`, 'success');

            alert('âœ… ê²Œì‹œê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì¹œëª© ê²Œì‹œíŒìœ¼ë¡œ ì´ë™í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.');
            
            // 5ì´ˆ í›„ ì¹œëª© ê²Œì‹œíŒìœ¼ë¡œ ì´ë™
            setTimeout(() => {
                window.location.href = '/board-free.html';
            }, 2000);
        }

        // 3. localStorage í™•ì¸
        function checkLocalStorage() {
            log('=== localStorage ì „ì²´ í™•ì¸ ===');
            const keys = Object.keys(localStorage);
            log(`ì „ì²´ í‚¤ ê°œìˆ˜: ${keys.length}`);
            
            keys.forEach(key => {
                if (key.startsWith('board_')) {
                    const data = localStorage.getItem(key);
                    const parsed = JSON.parse(data);
                    log(`${key}: ${Array.isArray(parsed) ? parsed.length + 'ê°œ í•­ëª©' : typeof parsed}`);
                }
            });

            // ì¹œëª© ê²Œì‹œíŒ ë°ì´í„° í™•ì¸
            const freePosts = localStorage.getItem('board_free_posts');
            if (freePosts) {
                const posts = JSON.parse(freePosts);
                log(`ì¹œëª© ê²Œì‹œíŒ ê²Œì‹œê¸€: ${posts.length}ê°œ`, 'success');
                posts.forEach((post, index) => {
                    log(`  ${index + 1}. [${post.id}] ${post.title} - ${post.author}`);
                });
            } else {
                log('ì¹œëª© ê²Œì‹œíŒ ë°ì´í„° ì—†ìŒ', 'error');
            }
        }

        // ê²Œì‹œíŒ ë°ì´í„° ì´ˆê¸°í™”
        function clearBoardData() {
            if (!confirm('ì •ë§ ëª¨ë“  ê²Œì‹œíŒ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            const keys = Object.keys(localStorage);
            keys.forEach(key => {
                if (key.startsWith('board_')) {
                    localStorage.removeItem(key);
                    log(`ì‚­ì œ: ${key}`);
                }
            });

            log('âœ… ê²Œì‹œíŒ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ', 'success');
            alert('ê²Œì‹œíŒ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.onload = function() {
            log('ğŸš€ ë””ë²„ê¹… ë„êµ¬ ë¡œë“œ ì™„ë£Œ');
            checkLoginStatus();
        };
    </script>
</body>
</html>
